variables:

default:
  timeout: 1800
  chef_config: solo.rb

tasks:
  - name: setup
    trigger: setup
    description: Execute setup chef
    operations:
      - chef:
          run_list:
            - role[{{role}}_setup]

  - name: configure
    trigger: configure
    description: Execute configure chef
    filter:
      service: postgresql
      tag: primary
    operations:
      - chef:
          run_list:
            - role[{{role}}_configure]
      - consul-event:
          name: configure-part
          filter:
            service: haproxy

  - name: configure-part
    trigger: configure-part
    description: Execute configure chef
    operations:
      - chef:
          run_list:
            - role[{{role}}_configure]

  - name: deploy
    trigger: deploy
    description: Execute deploy chef
    operations:
      - chef:
          run_list:
            - role[{{role}}_deploy]

  - name: backup
    trigger: backup
    description: Execute backup chef
    operations:
      - chef:
          run_list:
            - role[{{role}}_backup]

  - name: restore
    trigger: restore
    description: Execute restore chef
    operations:
      - chef:
          run_list:
            - role[{{role}}_restore]

  - name: spec
    trigger: spec
    description: Execute spec chef
    operations:
      - chef:
          run_list:
            - role[{{role}}_spec]
